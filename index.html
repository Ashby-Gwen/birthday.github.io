<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday ‚Äî Interactive Letter</title>
  <style>
    :root {
      --bg-1: #0b1020;
      --bg-2: #0b3b6f;
      --card: #fffdf8;
      --accent1: #ff3b6f;
      --accent4: #6b8cff;
      --paper-width: 920px;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: Inter, system-ui, Segoe UI, Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255, 255, 255, 0.04), transparent 8%),
                  linear-gradient(180deg, var(--bg-1) 0%, var(--bg-2) 60%);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .stage {
      display: flex;
      gap: 28px;
      flex-direction: column;
      align-items: center;
    }

    /* Envelope */
    .envelope {
      width: 300px;
      height: 200px;
      background: linear-gradient(180deg,#ff3b6f,#6b8cff);
      border-radius: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      color: white;
      font-weight: 800;
      font-size: 22px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      transition: transform 0.5s ease;
    }
    .envelope.opened { transform: scale(0.9) rotateX(180deg); opacity: 0; }

    /* Card */
    .card {
      width: var(--paper-width);
      max-width: 90%;
      background: var(--card);
      border-radius: 16px;
      padding: 26px;
      box-shadow: 0 30px 80px rgba(6, 15, 40, 0.6);
      position: relative;
      overflow: hidden;
      display: none; /* hidden until envelope clicked */
    }

    .letter-area {
      background: linear-gradient(180deg, #fffefc 0%, #fff6ee 100%);
      padding: 24px;
      border-radius: 12px;
      border: 1px solid rgba(10, 30, 50, 0.04);
      min-height: 320px;
      position: relative;
      overflow: hidden;
    }

    .letter {
      font-size: 20px;
      color: #0b2540;
      line-height: 1.6;
    }

    .confetti-canvas, #balloonLayer {
      position: absolute;
      top:0; left:0;
      width:100%;
      height:100%;
      pointer-events: none;
      z-index: 40;
    }
  </style>
</head>

<body>
  <div class="stage">
    <!-- Envelope -->
    <div class="envelope" id="envelope">üì© Open Me!</div>

    <!-- Letter card -->
    <div class="card" id="card">
      <div class="letter-area" id="letterArea">
        <canvas class="confetti-canvas" id="confetti"></canvas>
        <div id="balloonLayer" aria-hidden="true"></div>
        <div id="letter" class="letter">
          üéâ Happy Birthday Papa! üéâ<br><br>
          Wishing you a day filled with love, joy, and all the happiness in the world. Thank you for being an amazing father and inspiration.<br><br>
          Love, <br>
          Your Family ‚ù§Ô∏è
        </div>
      </div>
    </div>
  </div>

  <!-- background audio -->
  <audio id="bgm" loop preload="auto">
    <source src="bday_song.mp3" type="audio/mpeg">
  </audio>

  <script>
    const envelope = document.getElementById('envelope');
    const card = document.getElementById('card');
    const bgm = document.getElementById('bgm');

    envelope.addEventListener('click', () => {
      envelope.classList.add('opened');
      setTimeout(() => {
        envelope.style.display = 'none';
        card.style.display = 'block';
        bgm.play().catch(e=>console.log('Audio blocked:',e));
        startEffects();
      }, 600);
    });

    // Confetti + balloon system
    function startEffects() {
      const BALLOON_COLORS = [
        'linear-gradient(180deg,#ff3b6f,#ff6b9a)',
        'linear-gradient(180deg,#ffd166,#ffb46b)',
        'linear-gradient(180deg,#6ee7b7,#2ec49a)',
        'linear-gradient(180deg,#6b8cff,#4b6cff)'
      ];
      const POP_COLORS = ['#ff3b6f', '#ffd166', '#6ee7b7', '#6b8cff', '#c084fc', '#ff8ba7'];
      const letterArea = document.getElementById('letterArea');
      const balloonLayer = document.getElementById('balloonLayer');
      const confettiCanvas = document.getElementById('confetti');
      const ctx = confettiCanvas.getContext('2d');
      let particles = [];

      function resizeCanvas() {
        const r = window.devicePixelRatio || 1;
        confettiCanvas.width = letterArea.clientWidth*r;
        confettiCanvas.height = letterArea.clientHeight*r;
        confettiCanvas.style.width = letterArea.clientWidth+'px';
        confettiCanvas.style.height = letterArea.clientHeight+'px';
        ctx.setTransform(r,0,0,r,0,0);
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      function rand(min,max){return Math.random()*(max-min)+min;}
      function makeParticle(x,y,dir){return {x,y,vx:rand(80,320)*(dir==='left'?1:-1)/60,vy:rand(-8,-18),size:rand(6,16),rot:rand(0,360),vrot:rand(-14,14),life:rand(100,220),color:POP_COLORS[Math.floor(rand(0,POP_COLORS.length))]};}

      function emitConfetti(amount=80){
        const rect=letterArea.getBoundingClientRect();
        for(let i=0;i<amount;i++){
          const side=Math.random()>0.5?'left':'right';
          const y=rand(20,rect.height-20);
          const x=side==='left'?-10:rect.width+10;
          particles.push(makeParticle(x,y,side));
        }
      }

      function updateParticles(){
        for(let i=particles.length-1;i>=0;i--){
          const p=particles[i];
          p.x+=p.vx; p.y+=p.vy; p.vy+=0.34; p.rot+=p.vrot; p.life--;
          if(p.y>letterArea.clientHeight+60||p.life<=0) particles.splice(i,1);
        }
      }

      function drawParticles(){
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        for(const p of particles){
          ctx.save();
          ctx.translate(p.x+10,p.y+10);
          ctx.rotate(p.rot*Math.PI/180);
          ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6);
          ctx.restore();
        }
      }

      function confettiLoop(){ updateParticles(); drawParticles(); requestAnimationFrame(confettiLoop);}
      confettiLoop();
      setInterval(()=>emitConfetti(140), 1000+Math.random()*800);

      // Balloons
      function spawnBalloon(){
        const b=document.createElement('div');
        b.className='balloon';
        const col = BALLOON_COLORS[Math.floor(Math.random()*BALLOON_COLORS.length)];
        b.style.background = col;
        const scale = 0.7+Math.random()*0.45;
        b.style.width = Math.round(80*scale)+'px';
        b.style.height = Math.round(110*scale)+'px';
        const leftPct = 8 + Math.random()*84;
        b.style.left = leftPct+'%';
        const str=document.createElement('div'); str.className='string'; b.appendChild(str);
        const drift=(Math.random()*80)-40;
        const duration = Math.random()*6+7;
        const delay=Math.random()*1.2;
        b.style.animation = `rise ${duration}s linear ${delay}s forwards`;
        b.dataset.start = performance.now();
        b.dataset.duration = (duration+delay)*1000;
        b.dataset.drift = drift;
        balloonLayer.appendChild(b);
        setTimeout(()=>{ if(b.parentNode)b.parentNode.removeChild(b);}, (duration+delay)*1000+300);
      }

      setInterval(spawnBalloon, 1200);
      requestAnimationFrame(function animate(){
        document.querySelectorAll('.balloon').forEach(b=>{
          const elapsed=(performance.now()-b.dataset.start)/1000;
          const duration=parseFloat(b.dataset.duration)/1000;
          const drift=parseFloat(b.dataset.drift);
          const prog=Math.min(1,elapsed/duration);
          const initialLeft=parseFloat(b.style.left)||50;
          b.style.left=(initialLeft+drift*prog)+'%';
        });
        requestAnimationFrame(animate);
      });
    }
  </script>
</body>
</html>
